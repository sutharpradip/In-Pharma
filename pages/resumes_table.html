<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>In-Pharma | Global</title>

    <!-- Font Awesome CDN -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      crossorigin="anonymous"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
    />

    <!-- AOS -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/style.css" />
  </head>

  <body style="background-color: #f5f5f5">
    <header class="top-0 left-0 w-100 bg-white">
      <nav class="navbar bg-transparent">
        <div class="container">
          <a class="navbar-brand col-4 col-md-4 col-lg-2" href="#">
            <img
              class="img-fluid d-block"
              src="../assets/images/Logo.png"
              alt="In-Pharma"
            />
          </a>
        </div>
      </nav>
    </header>

    <main>
      <div class="container mt-4">
        <!-- FILTERS -->
        <div class="filter-section custom-shadow bg-white p-3 mb-4 rounded">
          <div class="row g-3">
            <div class="col-md-2">
              <label class="form-label">Gender</label>
              <select id="filterGender" class="form-select">
                <option value="">All</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">Candidate Type</label>
              <select id="filterType" class="form-select">
                <option value="">All</option>
                <option value="Fresher">Fresher</option>
                <option value="Experienced">Experienced</option>
              </select>
            </div>
          </div>

          <!-- Fresher Filters -->
          <div id="fresherFilters" class="row g-3 mt-3 d-none">
            <div class="col-md-3">
              <label class="form-label">Internship Done?</label>
              <select id="filterInternship" class="form-select">
                <option value="">All</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">Preferred Department</label>
              <select id="filterFresherDept" class="form-select">
                <option value="">All</option>
                <option value="QA">QA</option>
                <option value="Marketing">Marketing</option>
                <option value="R&D">R&D</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">Willing to Relocate?</label>
              <select id="filterRelocateFresher" class="form-select">
                <option value="">All</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>
          </div>

          <!-- Experienced Filters -->
          <div id="experiencedFilters" class="row g-3 mt-3 d-none">
            <div class="col-md-3">
              <label class="form-label">Current Department</label>
              <select id="filterExpDept" class="form-select">
                <option value="">All</option>
                <option value="Production">Production</option>
                <option value="IT">IT</option>
                <option value="R&D">R&D</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">Years of Experience</label>
              <select id="filterExp" class="form-select">
                <option value="">All</option>
                <option value="0-3">0–3 years</option>
                <option value="3-5">3–5 years</option>
                <option value="5+">5+ years</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">Notice Period</label>
              <select id="filterNotice" class="form-select">
                <option value="">All</option>
                <option value="Immediate">Immediate</option>
                <option value="15 days">15 days</option>
                <option value="60 days">60 days</option>
                <option value="90 days">90 days</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">Willing to Relocate?</label>
              <select id="filterRelocateExp" class="form-select">
                <option value="">All</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>
          </div>
        </div>

        <!-- TABLE AREA (unchanged) -->
        <div
          class="table-area bg-white custom-shadow p-3 rounded"
          style="max-height: 500px; overflow-y: auto"
        >
          <h3 class="px-3 pt-3 pb-2">Resumes</h3>
          <table class="table">
            <thead>
              <tr>
                <th class="text-capitalize fw-semibold">Resume Id</th>
                <th class="text-capitalize fw-semibold">Candiate Name</th>
                <th class="text-capitalize fw-semibold">Job Title</th>
                <th class="text-capitalize fw-semibold">Experience</th>
                <th class="text-capitalize fw-semibold">Email</th>
                <th class="text-capitalize fw-semibold">Contact No.</th>
                <th class="text-capitalize fw-semibold">Action</th>
              </tr>
            </thead>
            <tbody id="resumeTableBody" class="position-relative">
              <!-- data rendered here -->
            </tbody>
          </table>
          <div id="skeletonContainer" class="px-3 pb-3"></div>
        </div>
      </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
      AOS.init();
    </script>

    <script type="module">
      import resumes from "../assets/dummyData.js";

      const tbody = document.getElementById("resumeTableBody");

      // Toggle filter sections based on candidate type
      document.getElementById("filterType").addEventListener("change", () => {
        const type = document.getElementById("filterType").value;
        document
          .getElementById("fresherFilters")
          .classList.toggle("d-none", type !== "Fresher");
        document
          .getElementById("experiencedFilters")
          .classList.toggle("d-none", type !== "Experienced");
        renderTable();
      });

      function getFilterValues() {
        const type = document.getElementById("filterType").value;
        const filters = {
          gender: document.getElementById("filterGender").value,
          type: type,
        };

        if (type === "Fresher") {
          filters.internship =
            document.getElementById("filterInternship").value;
          filters.department =
            document.getElementById("filterFresherDept").value;
          filters.relocate = document.getElementById(
            "filterRelocateFresher"
          ).value;
        } else if (type === "Experienced") {
          filters.department = document.getElementById("filterExpDept").value;
          filters.exp = document.getElementById("filterExp").value;
          filters.notice = document.getElementById("filterNotice").value;
          filters.relocate = document.getElementById("filterRelocateExp").value;
        }

        return filters;
      }

      function matchExperience(expString, filterExp) {
        const years = parseInt(expString);
        if (filterExp === "0-3") return years >= 0 && years <= 3;
        if (filterExp === "3-5") return years > 3 && years <= 5;
        if (filterExp === "5+") return years > 5;
        return true;
      }

      function renderTable() {
        const filters = getFilterValues();
        tbody.innerHTML = "";

        const filtered = resumes.filter((res) => {
          if (filters.gender && res.gender !== filters.gender) return false;
          if (filters.type && res.type !== filters.type) return false;

          if (filters.type === "Fresher") {
            if (filters.internship && res.internship !== filters.internship)
              return false;
            if (filters.department && res.department !== filters.department)
              return false;
            if (filters.relocate && res.relocate !== filters.relocate)
              return false;
          } else if (filters.type === "Experienced") {
            if (filters.department && res.department !== filters.department)
              return false;
            if (filters.notice && res.notice !== filters.notice) return false;
            if (filters.relocate && res.relocate !== filters.relocate)
              return false;
            if (filters.exp && !matchExperience(res.exp, filters.exp))
              return false;
          }

          return true;
        });

        filtered.forEach((res) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${res.id}</td>
            <td>${res.name}</td>
            <td>${res.title}</td>
            <td>${res.exp}</td>
            <td>${res.email}</td>
            <td>${res.contact}</td>
            <td><a href="#" class="text-decoration-none table-download-btn">Download</a></td>
          `;
          tbody.appendChild(row);
        });
      }

      document
        .querySelectorAll(".form-select")
        .forEach((el) => el.addEventListener("change", renderTable));

      renderTable(); // initial
    </script>
  </body>
</html>
